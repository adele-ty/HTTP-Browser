# HTTPS握手和数据传输过程
1. 客户端发起一个加密网络（https）请求  
2. 服务端收到请求后使用CA证书产生公钥私钥密钥对，将包含公钥的证书发送给客户端  
3. 客户端开始验证证书的合法性，证书包含了发放日期、到期时间、颁发机构等信息，利用证书上的数字水印验证是否合法，如果不合法，会提出警告信息，如果证书合法，说明是可信赖的机构生产的  
4. 客户端产生一个随机key，使用公钥将其加密，发送给服务器，服务器使用私钥将其解密，存在服务端，此时客户端和服务器都拥有了一个没有被劫持的安全key  
5. 此后客户端和服务器的数据传输都使用此key加密，接收到数据之后使用本地存放在key解密（对称加密解密过程）  

HTTPS和TCP之间会有一个SSL层，以上所有过程都在SSL层中完成，比正常的http传输多了SSL握手过程和加密解密过程，会有一定的性能损耗  

![](https://user-images.githubusercontent.com/13034659/129229992-7927e85b-197d-4e45-8ee3-61bb9450365c.png)  

# 客户端如何验证证书的合法性
1. 首先浏览器读取证书中的证书所有者、有效期等信息进行校验，校验证书的网站域名是否与证书颁发的域名一致，校验证书是否在有效期内  
2. 浏览器开始查找操作系统中已内置的受信任的证书发布机构CA，与服务器发来的证书中的颁发者CA比对，用于校验证书是否为合法机构颁发  
3. 浏览器就会从操作系统中取出颁发者CA 的公钥(多数浏览器开发商发布版本时，会事先在内部植入常用认证机关的公开密钥)，客户端用公钥解密证书的数字签名，得到证书明文的hash，将证书明文用一样的方法（证书里有说明签名算法）计算出hash，两个hash值一样证书才合法

# 中间人攻击
中间人攻击过程如下：  
1. 服务器向客户端发送公钥。  
2. 攻击者截获公钥，保留在自己手上。  
3. 然后攻击者自己生成一个【伪造的】公钥，发给客户端。  
4. 客户端收到伪造的公钥后，生成加密hash值发给服务器。  
5. 攻击者获得加密hash值，用自己的私钥解密获得真秘钥。  
6. 同时生成假的加密hash值，发给服务器。  
7. 服务器用私钥解密获得假秘钥。  
8. 服务器用假秘钥加密传输信息  

防范方法：服务端在发送浏览器的公钥中加入CA证书，浏览器可以验证CA证书的有效性  

# http与https的区别
- HTTPS是加密传输协议，HTTP是明文传输协议;  
- HTTPS需要用到数字证书，而HTTP不用;  
- HTTPS比HTTP更加安全，对搜索引擎更友好，利于SEO,  
- HTTPS默认端口443，HTTP默认端口80;  
- HTTPS基于传输层，HTTP基于应用层;  